<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Shutokun Free Mode - 日本語OCR</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
</head>
<body>
  <h2>画像をアップロードしてください（GitHub Pages対応）</h2>
  <input type="file" id="imageUpload" accept="image/*"><br><br>
  <canvas id="canvas" style="display:none;"></canvas>
  <pre id="output">画像を待機中...</pre>

  <script>
    document.getElementById('imageUpload').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const img = new Image();
      img.onload = () => {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        canvas.toBlob((blob) => {
          document.getElementById('output').textContent = "OCR実行中...";

          Tesseract.recognize(
            blob,
            'jpn',
            {
              langPath: 'https://tessdata.projectnaptha.com/4.0.0_best', // Japanese traineddata
              tessedit_pageseg_mode: Tesseract.PSM.SINGLE_BLOCK
            }
          ).then(({ data }) => {
            const words = data.words.map(w => ({
              text: w.text,
              confidence: w.confidence,
              bbox: {
                x: w.bbox.x0,
                y: w.bbox.y0,
                width: w.bbox.x1 - w.bbox.x0,
                height: w.bbox.y1 - w.bbox.y0
              }
            }));
            document.getElementById('output').textContent = JSON.stringify({ words }, null, 2);
          });
        });
      };
      img.src = URL.createObjectURL(file);
    });
  </script>
</body>
</html>
