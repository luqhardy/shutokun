const admin = require('firebase-admin');
const axios = require('axios');
const fs = require('fs').promises;
const path = require('path');
const { convertToRomaji } = require('./kana-to-romaji');

// Initialize Firebase Admin
const serviceAccount = require('../serviceAccountKey.json');
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: "https://shutokun-default-rtdb.asia-southeast1.firebasedatabase.app/"
});

const db = admin.database();

// Rate limiting configuration
const RATE_LIMIT = 1000; // 1 second between requests
const BATCH_SIZE = 50; // Number of words to process in parallel

// JLPT level word lists
const JLPT_WORDS = {
  N5: [
    '学生', '水', '人', '本', '車', '時', '友達', '天気', '食べる', '飲む',
    '行く', '来る', '見る', '聞く', '話す', '書く', '読む', '買う', '売る', '住む',
    '学校', '先生', '勉強', '名前', '日曜日', '月曜日', '火曜日', 'お金', '家', '父',
    '母', '兄', '姉', '弟', '妹', '電話', '部屋', '猫', '犬', '机', '椅子',
    '駅', '電車', '店', '映画', '写真', '好き', '上手', '早い', '遅い', '大きい',
    '花', '山', '川', '魚', '肉', '野菜', '卵', '牛乳', '紅茶', '朝ご飯',
    '昼ご飯', '晩ご飯', '新聞', '雑誌', '音楽', '映画館', '公園', '病院', '会社', '仕事',
    // Added N5 words
    '私', 'あなた', '彼', '彼女', 'これ', 'それ', 'あれ', 'どれ', 'ここ', 'そこ',
    'あそこ', 'どこ', '誰', '何', 'いつ', 'なぜ', 'どう', '一', '二', '三',
    '四', '五', '六', '七', '八', '九', '十', '百', '千', '万', '円',
    '今', '今日', '明日', '昨日', '朝', '昼', '晩', '夜', '毎日', '毎週',
    '毎月', '毎年', '時間', '分', '半', '前', '後', '週', '月', '年',
    '曜日', '水曜日', '木曜日', '金曜日', '土曜日', '切符', '宿題', '風邪', '薬', '天気予報',
    '空', '海', '国', '外国', '道', '橋', '庭', '食べ物', '飲み物', '果物',
    'お茶', 'コーヒー', 'パン', 'ご飯', '味噌汁', '砂糖', '塩', '醤油', '油', 'バター',
    'コップ', '皿', 'スプーン', 'フォーク', 'ナイフ', '箸', '窓', 'ドア', '電気', 'ラジオ',
    'テレビ', 'カメラ', 'コンピューター', 'ペン', '鉛筆', '紙', 'ノート', '辞書', '手紙', '切手',
    '封筒', '葉書', '鞄', '財布', '時計', '傘', '帽子', '靴', '服', 'シャツ',
    'ズボン', 'スカート', 'コート', 'セーター', '眼鏡', '家族', '両親', '子供', '妻', '夫',
    'お爺さん', 'お婆さん', '伯父さん', '叔父さん', '伯母さん', '叔母さん', '従兄弟', '従姉妹', '町', '村',
    '市', '県', '空港', '港', '銀行', '郵便局', '図書館', '美術館', '大使館', '交番',
    '会議', '受付', '事務所', '工場', '店員', '医者', '看護師', '警察官', '運転手', '歌手',
    '作家', '画家', '俳優', '女優', 'スポーツ', '野球', 'サッカー', 'テニス', 'ゴルフ', '水泳',
    'スキー', 'スケート', '趣味', '旅行', '散歩', '買い物', '食事', 'パーティー', 'デート', 'プレゼント',
    '切る', '送る', 'もらう', '貸す', '借りる', '教える', '習う', '掛ける', '付ける', '消す',
    '開ける', '閉める', '置く', '作る', '手伝う', '待つ', '持つ', '取る', '撮る', '死ぬ',
    '遊ぶ', '泳ぐ', '疲れる', '結婚する', '離婚する', '生まれる', '入る', '出る', '乗る',
    '降りる', '着く', '始まる', '終わる', '休む', '働く', '勉強する', '旅行する', '買い物する', '食事する',
    '散歩する', '運動する', '練習する', '掃除する', '洗濯する', '料理する', '修理する', '説明する', '紹介する', '案内する',
    '相談する', '連絡する', '報告する', '出発する', '到着する', '帰る', '上げる', '下げる', '赤い', '青い',
    '黒い', '白い', '黄色い', '茶色い', '緑色', '紫色', 'ピンク色', 'オレンジ色', '灰色', '新しい',
    '古い', '良い', '悪い', '暑い', '寒い', '熱い', '冷たい', '美味しい', '不味い', '甘い',
    '辛い', '苦い', '酸っぱい', '塩辛い', '濃い', '薄い', '広い', '狭い', '高い', '低い',
    '重い', '軽い', '忙しい', '暇', '元気', '病気', '親切', '便利', '不便', '綺麗',
    '汚い', '静か', '賑やか', '有名', 'ハンサム', '色々', '同じ', '違う', 'たくさん', '少し',
    'ちょっと', 'もっと', 'ずっと', 'すぐ', 'ゆっくり', 'よく', 'あまり', '全然', '一緒に', '別に',
    '初めて', 'どうして', 'だから', 'しかし', 'そして', 'それから', 'では', 'はい', 'いいえ', 'ゼロ',
    'もう一度', 'お土産', 'お弁当', '地図', '体', '頭', '髪', '顔', '目', '耳', '鼻', '口',
    '歯', '喉', '首', '手', '足', '指', '背中', 'お腹', '心', '風', '曇り', '晴れ', '雨',
    '雪', '春', '夏', '秋', '冬', '北', '南', '東', '西', '上', '下', '右', '左', '中',
    '外', '隣', '近く', '遠く', '間', '男の子', '女の子', '大人', '子供', '言葉', '文字', '絵',
    '歌', '踊り', '安い', '楽しい', '面白い', 'つまらない', '難しい', '易しい', '危ない', '安全',
    '大丈夫', '大切', '必要', '十分', '駄目', '丈夫', '弱い', '強い', '暗い', '明るい', '忘れる',
    '覚える', '失くす', '見つける', '拾う', '払う', '返す', '脱ぐ', '着る', '磨く', '洗う', '立つ',
    '座る', '寝る', '起きる', '歩く', '走る', '飛ぶ', '笑う', '泣く', '怒る', '喜ぶ', '心配する',
    '頑張る', '休憩する', '質問する', '答える', 'お願いする', '気をつける', 'おめでとう', 'ありがとう', 'すみません', 'ごめんなさい',
    'さようなら', 'おやすみなさい', 'こんにちは', 'こんばんは', 'おはようございます', 'いただきます', 'ごちそうさまでした', 'いってきます', 'いってらっしゃい', 'ただいま',
    'おかえりなさい', 'どうぞ', 'どういたしまして'
  ],
  N4: [
    '準備', '予定', '予約', '確認', '説明', '紹介', '案内', '相談', '連絡', '報告',
    '留学', '通訳', '交通', '運転', '引っ越し', '生活', '経験', '習慣', '安全', '危険',
    '使用', '禁止', '必要', '可能', '不便', '簡単', '複雑', '特別', '最近', '将来',
    '以上', '以下', '以外', '以内', '原因', '結果', '方法', '理由', '約束', '希望',
    '苦手', '得意', '褒める', '怒る', '泣く', '笑う', '願う', '祈る', '約束する', '連れて行く',
    '迎えに行く', '遅刻', '早退', '欠席', '出席', '職業', '就職', '退職', '面接', '履歴書',
    // Added N4 words
    '意見', '意味', '音', '味', '匂い', '気温', '熱', '光', '形', '色',
    '高さ', '長さ', '重さ', '広さ', '速さ', '大切', '十分', '無理', '丁寧', '失礼',
    '残念', '心配', '熱心', '一生懸命', '優しい', '厳しい', '怖い', '嬉しい', '悲しい', '寂しい',
    '恥ずかしい', '眠い', '乾く', '濡れる', '汚れる', '壊れる', '直る', '治る', '合格する', '不合格になる',
    '成功する', '失敗する', '続く', '続ける', '見つける', '見つかる', '決める', '決まる', '選ぶ', '知らせる',
    '頼む', '断る', '手伝う', '助ける', '招待する', '参加する', '集まる', '集める', '分ける', '配る',
    '拾う', '捨てる', '投げる', '打つ', '押す', '引く', '並ぶ', '並べる', '比べる', '競争する',
    '戦争', '平和', '文化', '歴史', '法律', '政治', '経済', '社会', '自然', '科学',
    '技術', '教育', '宗教', '芸術', '文学', '音楽会', '展覧会', '試合', '大会', '祭り',
    '正月', 'お盆', 'クリスマス', '誕生日', '卒業式', '入学式', '結婚式', '葬式', '趣味', '特技',
    '興味', '夢', '目標', '計画', '思い出', '日記', '手帳', '住所', '地図', '駐車場',
    '動物園', '植物園', '遊園地', '体育館', '競技場', 'プール', '温泉', '旅館', 'ホテル', '民宿',
    'アパート', 'マンション', 'ビル', '教会', '神社', '寺', '工場', '農場', '漁港', '市役所',
    '区役所', '都庁', '県庁', '警察署', '消防署', '放送局', '新聞社', '出版社', '銀行口座', '貯金',
    '現金', 'クレジットカード', '保険', '年金', '税金', '給料', 'ボーナス', '家賃', '電気代', 'ガス代',
    '水道代', '電話代', '交通費', '食費', '学費', '手術', '入院', '退院', '薬局', '会議室',
    '受付', '事務所', '研究室', '実験室', '講堂', '廊下', '階段', 'エレベーター', 'エスカレーター', '自動ドア',
    'エアコン', 'ストーブ', '扇風機', '冷蔵庫', '電子レンジ', '洗濯機', '掃除機', 'パソコン', 'ワープロ', 'コピー機',
    'ファックス', 'インターネット', 'メール', 'ウェブサイト', 'ブログ', 'SNS', 'ゲーム', 'ニュース', '番組', 'ドラマ',
    '漫画', '小説', '詩', '絵本', '辞典', '教科書', '参考書', '問題集', '作文', '論文',
    '発表', '講演', '会議', '議論', '討論', '交渉', '契約', '法律', '規則', '権利',
    '義務', '責任', '事件', '事故', '犯罪', '警察', '裁判', '法律家', '弁護士', '検事',
    '裁判官', '証人', '被害者', '加害者', '記事', '広告', '番組', '報道', '情報', '噂',
    '秘密', '冗談', '嘘', '本当', '事実', '現実', '理想', '夢', '空想', '迷信',
    '運', '才能', '努力', '勇気', '自信', '希望', '不安', '恐怖', '喜び', '悲しみ',
    '怒り', '驚き', '感動', '感謝', '謝罪', '許し', '愛', '友情', '信頼', '裏切り',
    '競争', '協力', '対立', '平和', '国際関係', '国内問題', '環境問題', '社会問題', '教育問題', '経済問題',
    '迎える', '送る', '訪問する', '見学する', '参加する', '申し込む', '手続きする', '輸出する', '輸入する', '翻訳する',
    '発明する', '発見する', '建設する', '生産する', '消費する', '販売する', '購入する', '利用する', '修理する', '保存する',
    '保護する', '開発する', '進歩する', '発展する', '変化する', '成長する', '競争する', '協力する', '反対する', '賛成する',
    '解決する', '努力する', '我慢する', '頑張る', '確かめる', '間違える', '謝る', '祈る', '祝う', '尊敬する',
    '信用する', '疑う', '期待する', 'がっかりする', 'びっくりする', '安心する', '心配する', '感動する', '興奮する', '緊張する',
    '慣れる', '飽きる', '諦める', '後悔する', '満足する', '不満を持つ', '苦労する', '迷惑をかける', '役に立つ', '間に合う',
    '通り過ぎる', '戻る', '進む', '止まる', '曲がる', '渡る', '気をつける', '風邪をひく', '怪我をする', '入院する',
    '退院する', '太る', '痩せる', '合格する', '卒業する', '就職する', '退職する', '結婚する', '離婚する', '亡くなる',
    '生まれる', '育つ', '引っ越す', '留学する', '帰国する', '出張する', '旅行する', '観光する', '休憩する', '昼寝する',
    '残業する', '早退する', '遅刻する', '欠席する', '出席する', 'アルバイトをする', 'ボランティアをする', '寄付する', '貯金する', '両替する',
    '払う', '受け取る', '貸す', '借りる', '返す', '送る', '届ける', '拾う', '捨てる', '片付ける',
    '掃除する', '洗濯する', '料理する', '運転する', '駐車する', '修理する', '世話をする', '相談に乗る', '手伝う', '案内する',
    '紹介する', '説明する', '報告する', '連絡する', '予約する', '注文する', 'キャンセルする', '変更する', '確認する', '質問する',
    '答える', '調べる', '覚える', '忘れる', '思い出す', '考える', '感じる', '信じる', '疑う', '比べる',
    '選ぶ', '決める', '続ける', '辞める', '始める', '終わる', '使う', '作る', '売る', '買う',
    '切る', '折る', '破る', '開ける', '閉める', '付ける', '消す', '押す', '引く', '持つ',
    '置く', '座る', '立つ', '歩く', '走る', '飛ぶ', '泳ぐ', '登る', '降りる', '乗る',
    '降りる', '着る', '脱ぐ', '履く', '被る', '磨く', '洗う', '拭く', '乾かす', '冷やす',
    '温める', '沸かす', '焼く', '煮る', '炒める', '揚げる', '蒸す', '混ぜる', '飾る', '包む',
    '貼る', '塗る', '描く', '歌う', '踊る', '弾く', '撮る', '録画する', '録音する', '印刷する',
    'コピーする', '削除する', '保存する', '送信する', '受信する', 'ダウンロードする', 'アップロードする', 'インストールする', 'アンインストールする', 'クリックする',
    'ドラッグする', 'タイプする', '検索する', '翻訳する', 'プログラミングする', 'デザインする', '設計する', '発明する', '発見する', '実験する',
    '観察する', '分析する', '評価する', '判断する', '予測する', '計画する', '実行する', '管理する', '指導する', '協力する',
    '競争する', '交渉する', '契約する', '法律を守る', '規則に従う', '権利を主張する', '義務を果たす', '責任を負う', 'ボランティア活動をする', 'リサイクルする',
    '節約する', '環境を守る', '動物を愛護する', '植物を育てる', '健康に気をつける', '安全運転をする', '交通ルールを守る', 'マナーを守る', '丁寧な言葉遣いをする', '挨拶をする',
    '具合', '気分', '事故', '地震', '台風', '洪水', '火事', '泥棒', '怪我', '病気',
    '熱', '咳', '鼻水', '頭痛', '腹痛', '歯痛', '喉が渇く', 'お腹が空く', '眠い', '疲れる',
    '若い', '年寄り', '元気', '親切', '真面目', '正直', '賢い', '馬鹿', '可愛い', '美しい',
    '醜い', '静か', '賑やか', '有名', '無名', '自由', '便利', '不便', '簡単', '複雑',
    '上手', '下手', '得意', '苦手', '好き', '嫌い', '欲しい', '要る', '足りる', '残る',
    '違う', '同じ', '正しい', '間違い', '深い', '浅い', '厚い', '薄い', '硬い', '柔らかい',
    '細い', '太い', '明るい', '暗い', '遠い', '近い', '早い', '遅い', '多い', '少ない',
    '重い', '軽い', '暖かい', '涼しい', '暑い', '寒い', '熱い', '冷たい', '甘い', '辛い',
    '苦い', '酸っぱい', '塩辛い', '濃い', '薄い', '広い', '狭い', '高い', '低い', '丸い',
    '四角い', '長い', '短い', '必ず', '絶対に', 'たぶん', 'きっと', 'もし', 'いくら', 'どんなに',
    'なぜなら', 'ですから', 'けれども', 'しかし', 'それに', 'そして', 'それから', 'または', '例えば', '特に',
    '初めて', '最後に', 'だんだん', 'どんどん', 'ますます', 'やっと', 'とうとう', 'すぐに', 'ゆっくり', 'ちょうど',
    'しっかり', 'はっきり', 'びっくり', 'がっかり', 'うっかり', 'のんびり', 'ぼんやり', 'そっくり', 'こっそり', 'ぎりぎり'
  ],
  N3: [
    '改善', '向上', '発展', '進歩', '成長', '変化', '影響', '関係', '状況', '環境',
    '経済', '政治', '社会', '文化', '技術', '教育', '効果', '制度', '表現', '意見',
    '情報', '報道', '事件', '事故', '印象', '感想', '選択', '決定', '準備', '整理',
    '理解', '協力', '責任', '対応', '提出', '参加', '支援', '努力', '挑戦', '目標',
    '不満', '満足', '感情', '感謝', '尊敬', '誤解', '納得', '疑問', '期待', '緊張',
    '援助', '協調', '尊重', '規則', '法律', '義務', '権利', '成果',
    // Added N3 words
    '広告', '会議', '会場', '機会', '希望', '競争', '興味', '偶然', '経験', '現象',
    '現実', '現状', '限界', '貢献', '幸福', '行動', '国際', '国内', '個人',
    '差別', '参考', '産業', '資金', '事情', '自信', '自然', '事実', '実績',
    '実行', '実験', '実現', '実際', '実力', '実感', '質問', '指定', '指導', '支配',
    '示す', '占める', '重視', '周囲', '瞬間', '順番', '冗談', '条件', '状態',
    '証明', '消費', '商品', '将来', '職員', '食事', '進学', '推薦', '数字',
    '制限', '製品', '政策', '精神', '成績', '生産', '設備', '絶対', '積極的',
    '消極的', '具体的', '抽象的', '一般的', '部分的', '全体的', '平均', '平等', '平和', '豊富',
    '無料', '有料', '有利', '不利', '複雑', '単純', '重要', '主要', '必要', '不要',
    '可能', '不可能', '当然', '突然', '結局', '確か', '多分', '恐らく', 'もしかしたら', 'まさか',
    '決して', '全く', '別に', '特に', '非常に', 'かなり', '随分', '大分', '少しも', '一層',
    'ますます', 'だんだん', '徐々に', '次第に', '常に', '時々', '偶に', 'しばしば', '頻繁に', 'めったに',
    '既に', '未だ', 'これから', '今後', '将来', '過去', '現在', '当時', '先日', '後日',
    '翌日', '同時', '瞬間', '途中', '最初', '最後', '以前', '以後', '以内', '以外',
    '以上', '以下', '周辺', '付近', '各地', '全国', '世界', '地球', '宇宙', '太陽',
    '月', '星', '空', '雲', '雨', '雪', '風', '嵐', '雷', '地震',
    '津波', '火山', '噴火', '災害', '被害', '避難', '救助', '復興', 'ボランティア', '寄付',
    '運動', '競技', '選手', '監督', 'コーチ', 'チーム', '試合', '勝利', '敗北', '引き分け',
    '記録', '優勝', '準優勝', 'オリンピック', 'ワールドカップ', '大会', '予選', '決勝', '応援', 'ファン',
    '解決する', '活躍する', '確認する', '観察する', '記録する', '議論する', '工夫する', '苦労する', '計画する', '検査する',
    '研究する', '建設する', '貢献する', '行動する', '克服する', '工夫する', '比較する', '批判する', '評価する', '分析する',
    '分類する', '変更する', '報告する', '募集する', '訪問する', '翻訳する', '輸入する', '輸出する', '予防する', '流行する',
    '理解する', '利用する', '留学する', '旅行する', '練習する', '連絡する', '議論する', '命令する', '迷惑する', '目指す',
    '申し込む', '物語る', '役立つ', '約束する', '優先する', '許す', '輸入する', '輸出する', '譲る', '予測する',
    '発表する', '発明する', '発見する', '発展する', '販売する', '比較する', '批判する', '評価する', '普及する', '分類する',
    '分析する', '変化する', '編集する', '変更する', '冒険する', '報道する', '募集する', '保存する', '翻訳する', '満足する',
    '明確', '適切', '共通', '深刻', '独特', '派手', '地味', '賢い', '優しい', '厳しい',
    '正直', '素直', '頑固', 'わがまま', '生意気', '臆病', '勇敢', '活発', '消極的', '楽観的',
    '悲観的', '協調性がある', '責任感がある', '好奇心が強い', '忍耐強い', '短気', '気が長い', '気が短い', '面白い', 'つまらない',
    '退屈', '快適', '不快', '不安', '恐怖', '心配', '安心', '喜び', '悲しみ', '怒り',
    '驚き', '感動', '興奮', '緊張', 'リラックス', 'ストレス', '健康', '病気', '怪我', '治療',
    '手術', '薬', '検査', '診断', '予防', '症状', '回復', 'アレルギー', '花粉症', '風邪',
    'インフルエンザ', '熱', '咳', '頭痛', '腹痛', '吐き気', 'めまい', '怪我をする', '骨折する', '火傷する',
    '意識', '記憶', '想像', '創造', '思考', '判断', '推理', '論理', '意志',
    '話題', '雰囲気', '魅力', '秘密', '冗談', '噂', '悪口', '評判', '信用', '信頼',
    '裏切り', '仲直り', '喧嘩', '悩み', '解決', '相談', '助言', '提案', '反対', '賛成',
    '確認', '許可', '命令', '依頼', '断り', '謝罪', '感謝', '祝福', 'お祝い', '見舞い',
    '葬式', '結婚', '離婚', '誕生', '死', '出発', '到着', '合格', '不合格', '成功',
    '失敗', '勝利', '敗北', '優勝', '失恋', '再会', '別れ', '出会い', '友情', '愛情',
    '恋愛', '家族愛', '尊敬', '軽蔑', '憧れ', '嫉妬', '憎しみ', '喜び', '悲しみ', '怒り',
    '恐れ', '驚き', '感動', '興奮', '安心', '不安', '満足', '不満', '希望', '絶望',
    '勇気', '自信', 'プライド', '劣等感', '罪悪感', '孤独感', '幸福感', '不幸感', '充実感', '虚無感',
    '開放感', '閉塞感', '一体感', '疎外感', '違和感', '共感', '同情', '無関心', '退屈', '興味津々'
  ],
  N2: [
    '実現', '達成', '成功', '失敗', '挑戦', '努力', '経験', '知識', '技術', '能力',
    '判断', '理解', '評価', '分析', '選択', '影響', '支配', '管理', '調整', '指導',
    '開発', '維持', '改善', '改革', '実施', '要因', '傾向', '理想', '現実', '限界',
    '条件', '手段', '基準', '方針', '資源', '制度', '経営', '環境', '産業', '雇用',
    '適応', '統一', '分離', '構成', '要請', '需要', '供給', '契約', '保障',
    '拡大', '縮小', '緩和', '強化', '分野', '概念', '経路', '資産',
    // Added N2 words
    '意識', '安定', '違反', '依頼', '医療', '営業', '温暖化', '価格', '活躍', '過程',
    '価値', '仮定', '競争', '共通', '協力', '許可', '吸収', '強調', '共同',
    '記録', '議論', '禁止', '緊張', '偶然', '具体', '継続', '景気', '警告',
    '芸術', '経費', '結果', '結構', '健康', '現象', '現在', '建築',
    '貢献', '広告', '攻撃', '公正', '構造', '行動', '効率', '克服', '国民', '国内',
    '困難', '混乱', '差別', '裁判', '作業', '作者', '作品', '削除', '支持', '支出',
    '事情', '施設', '自然', '市場', 'システム', '指導', '支配', '実験', '実現', '実力',
    '収入', '集中', '主張', '出発', '出版', '寿命', '種類', '瞬間', '順番', '処理',
    '奨学金', '承認', '症状', '情報', '証明', '消費', '商品', '衝突', '信頼', '深刻',
    '進学', '診断', '信仰', '人工', '申請', '信用', '心理', '推薦', '推測', '数字',
    '制作', '成長', '製品', '政策', '精神', '制限', '精算', '製造', '責任', '積極的',
    '接近', '接続', '設備', '説得', '節約', '選択', '専用', '専門', '組織', '操作',
    '総合', '想像', '騒音', '相対', '存在', '尊重', '態度', '逮捕', '対策', '単純',
    '担当', '地域', '地位', '注目', '注文', '長所', '短所', '調査', '挑戦',
    '直接', '提案', '提供', '程度', '典型', '伝統', '天然', '統一', '到着', '登録',
    '投票', '導入', '特定', '独立', '突然', '納得', '日程', '認識', '能力', '農薬',
    '背景', '配達', '発生', '発達', '発売', '発表', '違反', '比較', '被害', '秘密',
    '微妙', '批判', '評価', '表現', '平等', '普及', '服装', '物質', '物理', '分析',
    '雰囲気', '分類', '平均', '変更', '編集', '弁護士', '法律', '豊富', '方向', '報告',
    '保証', '保存', '翻訳', '募集', '貿易', '冒険', '満足', '魅力', '命令', '目的',
    '目標', '役割', '輸出', '輸入', '唯一', '勇気', '有効', '優勝', '友情', '有利',
    '予測', '予防', '理解', '利益', '流行', '両替', '料金', '理論', '連続', '老人',
    '労働', '論争', '議論する', '依頼する', '解決する', '確認する', '活躍する', '感動する', '観察する', '管理する',
    '記録する', '禁止する', '工夫する', '継続する', '計画する', '契約する', '攻撃する', '克服する', '指示する', '支持する',
    '実験する', '実現する', '集中する', '主張する', '出版する', '承認する', '証明する', '消費する', '信頼する', '推薦する',
    '制作する', '制限する', '製造する', '説得する', '選択する', '操作する', '想像する', '尊重する', '逮捕する', '担当する',
    '調査する', '調整する', '挑戦する', '提案する', '提供する', '登録する', '投票する', '導入する', '納得する', '認識する',
    '発生する', '発達する', '発売する', '発表する', '批判する', '評価する', '普及する', '分析する', '分類する', '変更する',
    '編集する', '報告する', '保証する', '保存する', '翻訳する', '募集する', '貿易する', '冒険する', '命令する', '輸出する',
    '輸入する', '予測する', '予防する', '理解する', '流行する', '連続する', '労働する', '論争する', '明らか', '曖昧',
    '安全', '危険', '異常', '正常', '意外', '当然', '快適', '不快', '活発', '消極',
    '簡単', '複雑', '巨大', '微小', '深刻', '楽観', '悲観', '純粋', '新鮮',
    '乾燥', '湿潤', '透明', '不透明', '豊か', '貧しい', '賢い', '愚か', '謙虚', '傲慢',
    '正直', '不正直', '親切', '不親切', '公平', '不公平', '幸福', '不幸', '重要', '些細',
    '偶然', '必然', '絶対', '相対', '積極', '消極', '肯定的', '否定的', '部分的', '全体的',
    '作成', '削除', '更新', '追加', '変更', '修正', '確認', '承認', '拒否', '保留',
    '申請', '受理', '却下', '進捗', '完了', '未了', '中断', '再開', '延期', '中止',
    '企画', '設計', '開発', '試験', '運用', '保守', '改善', '提案', '検討', '協議',
    '合意', '契約', '交渉', '調達', '生産', '販売', '購入', '在庫', '出荷', '配送',
    '回収', '廃棄', '分析', '報告', '評価', '監査', '指導', '教育', '研修', '採用',
    '退職', '昇進', '降格', '異動', '出張', '会議', '面談', '相談', '苦情', '要望'
  ],
  N1: [
    '抽象', '具体', '理論', '実践', '分析', '総合', '批判', '評価', '判断', '決定',
    '認識', '概念', '仮説', '構造', '要素', '矛盾', '証明', '本質', '論理', '展開',
    '志向', '促進', '抑制', '維持', '排除', '依存', '融合', '多様', '革新', '提携',
    '支援', '貢献', '確保', '連携', '責任', '実態', '概況', '傾向', '認定', '指摘',
    '推論', '前提', '帰結', '整合性', '先入観', '偏見', '抽出', '暗示', '矛盾点', '普遍',
    '特殊', '恒常', '仮定', '実証', '客観', '主観', '体系', '帰納', '演繹', '命題',
    // Added N1 words
    '曖昧模糊', '一概に', '一斉に', '遺伝', '威力', '円滑', '縁談', '緩和', '介入', '解剖',
    '棄権', '規範', '巧妙', '究極', '共存', '凝縮', '均衡', '愚痴', '権威',
    '効率', '克明', '根拠', '錯誤', '察知', '真髄', '声明', '措置', '妥協',
    '追求', '痛感', '締結', '撤廃', '同様', '独自', '任命', '熱意', '背景', '発祥',
    '批准', '描写', '憤慨', '補償', '発掘', '模倣', '誘惑', '擁護',
    '楽観', '了解', '倫理', '累積', '枠組み', '賄賂', '軋轢', '享受', '吟味',
    '緊密', '束縛', '妥結', '耽溺', '陳腐', '墜落', '顕著', '倹約', '広範',
    '焦燥', '樹立', '潤沢', '辛辣', '脆弱', '促進', '端的', '蓄積',
    '調和', '沈黙', '追放', '定義', '提示', '抵抗', '停滞', '適宜', '徹底', '動向',
    '統合', '透明', '途端', '鈍感', '内臓', '内緒', '軟弱', '任務',
    '熱狂', '破壊', '暴露', '繁栄', '反映', '反発', '悲観',
    '必然', '敏感', '頻繁', '普及', '腐敗', '分離', '憤慨', '変動',
    '弁償', '変遷', '便宜', '膨大', '報道', '飽和', '保護', '補給', '募集', '没頭',
    '模索', '模様', '優先', '融資', '誘導', '猶予', '優越', '憂鬱', '要請', '要因',
    '譲歩', '濫用', '類似', '老衰', '浪費', '論議', '歪曲',
    '明白', '悪循環', '安全保障', '安易', '異議', '意義', '異議を唱える',
    '意気込み', '経緯', '移行', '依然として', '依存症', '委託', '威張る', '違法', '医療過誤',
    '印鑑', '隠蔽', '受け継ぐ', '内訳', '遠慮', '汚職', '解雇', '懐疑的', '開拓',
    '該当', '概要', '改良', '乖離', '顧みる', '過言', '過疎化', '過保護', '過労',
    '画期的', '提起', '協議', '強硬', '共感', '共存共栄', '供与', '協調', '極端', '拒否',
    '区画', '駆使', '苦情', '削減', '殺到', '察する', '参入',
    '仕掛ける', '施行', '試行錯誤', '資産運用', '自炊', '失脚', '実践的', '執着', '司法', '指名',
    '釈明', '主観的', '主導権', '奨励', '証拠', '衝撃', '象徴', '助言',
    '審査', '進展', '真相', '迅速', '振興', '推移', '崇拝', '成熟', '正当化', '制約',
    '切実', '設置', '説得力', '潜在的', '先導', '専念', '繊維', '増殖', '即座に',
    '側面', '阻害', '誇張', '妥協案', '多岐にわたる', '打開', '着手', '忠告', '重複',
    '調停', '挑戦状', '沈殿', '陳述', '追及', '追跡', '痛烈', '提訴', '低迷',
    '適合', '撤回', '徹夜', '典型的', '展望', '動機', '同調', '動揺', '独占', '土壌',
    'ニュアンス', '念頭に置く', 'ノウハウ', '媒体', '買収', '派遣', '発足', '発言権',
    '抜粋', '抜本的', '反響', '氾濫', '備蓄', '風刺', '封鎖',
    '赴任', '浮上', '不備', '便宜を図る', '変革', '返済', '妨害', '飽和状態',
    '傍聴', '報酬', '放棄', '発作', '憤り', '無償', '免除',
    '網羅', '野党', '融通', '優位性', '誘拐', '有益', '有数', '懸念', '容認',
    '利潤', '理念', '両立', '倫理観', '斡旋', '強いる',
    '愚弄', '警戒', '軽蔑', '固執', '誇示', '采配', '搾取', '示唆', '称賛',
    '推進', '衰退', '是正', '切望', '詮索', '訴訟', '綻びる', '陳謝',
    '抵触', '統治', '踏襲', '鈍化', '配慮', '排斥',
    '核心', '拡散', '獲得', '確立', '加味', '監視',
    '欺瞞', '共鳴', '拒絶', '許容', '禁物', '疑惑',
    '屈折', '経過', '軽減', '決裂', '権限', '限定',
    '後悔', '考慮', '誤認', '再生', '催促',
    '錯覚', '参照', '賛同', '仕組み', '試行', '執行',
    '失踪', '始末', '循環', '承諾', '消耗',
    '制御', '制覇', '精密', '折衝', '損失',
    '断念', '中断', '到底', '途絶',
    '把握', '発揮', '反応', '匹敵', '規制',
    '架空', '妥当性', '妥当', '遂行', '遂げる', '派生', '変遷', '促進', '阻害', '啓発',
    '錯誤', '訴求', '擁立', '擁護', '委託', '受託', '批准', '採択', '否決', '棄権',
    '調印', '締結', '破棄', '履行', '執行猶予', '黙秘権', '冤罪', '時効', '弾劾', '罷免',
    '斡旋', '仲介', '調停', '和解', '示談', '告訴', '告発', '起訴', '控訴', '上告',
    '陳情', '請願', '献金', '癒着', '派閥', '内閣', '官僚', '天下り', '財閥', '寡占',
    '独占禁止法', 'カルテル', 'トラスト', 'コンツェルン', 'インフレ', 'デフレ', 'スタグフレーション', '金融緩和', '金融引き締め', '財政政策',
    '規制緩和', '市場原理', '投機', 'バブル経済', '不良債権', '債務不履行', 'デフォルト', '風評被害', 'デマ', 'プロパガンダ',
    '世論操作', '既得権益', 'グローバル化', 'ローカル化', '多文化共生', 'ジェンダー', 'ダイバーシティ', 'インクルージョン', 'サステナビリティ', 'SDGs',
    'カーボンニュートラル', 'デジタルトランスフォーメーション', 'DX', 'AI倫理', 'ビッグデータ', 'IoT', 'シンギュラリティ', 'ベーシックインカム', 'ワークライフバランス', '終身雇用',
    '年功序列', '成果主義', '派遣労働', '非正規雇用', '格差社会', '貧困問題', '少子高齢化', '過疎化', '限界集落', '地方創生'
  ]
}
// Sleep function for rate limiting
const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

// Fetch word data from Jisho API
async function fetchWordData(word) {
  try {
    const response = await axios.get(`https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(word)}`);
    const data = response.data.data[0]; // Get first result
    
    if (!data) {
      console.warn(`No data found for word: ${word}`);
      return null;
    }

    // Extract relevant information
    const japanese = data.japanese[0];
    const senses = data.senses[0];
    const kana = japanese.reading || '';

    return {
      word: japanese.word || word,
      kana: kana,
      romaji: convertToRomaji(kana),
      meaning: senses.english_definitions.join(', '),
      pos: senses.parts_of_speech.join(', '),
      usage_notes: senses.info ? senses.info.join(', ') : null,
      related_words: senses.see_also ? senses.see_also.map(word => ({
        word,
        meaning: '' // We'll need to fetch these separately if needed
      })) : null,
      examples: data.jlpt ? [{
        jp: japanese.word,
        en: senses.english_definitions[0],
        context: 'Basic usage'
      }] : null
    };
  } catch (error) {
    console.error(`Error fetching data for word ${word}:`, error.message);
    return null;
  }
}

// Process words in batches
async function processWordBatch(words, level) {
  const results = [];
  for (const word of words) {
    try {
      const wordData = await fetchWordData(word);
      if (wordData) {
        results.push({
          ...wordData,
          jlpt: level
        });
      }
      await sleep(RATE_LIMIT); // Rate limiting
    } catch (error) {
      console.error(`Error processing word ${word}:`, error.message);
    }
  }
  return results;
}

// Build vocabulary database from API
async function buildVocabularyDatabase() {
  try {
    const vocabularyRef = db.ref('vocabulary');
    const updates = {};

    for (const [level, words] of Object.entries(JLPT_WORDS)) {
      console.log(`Processing ${level} words...`);
      
      // Process words in batches
      for (let i = 0; i < words.length; i += BATCH_SIZE) {
        const batch = words.slice(i, i + BATCH_SIZE);
        const batchResults = await processWordBatch(batch, level);
        
        // Add to updates
        batchResults.forEach(word => {
          if (word.kana) {
            updates[`${level}/words/${word.kana}`] = word;
          }
        });

        console.log(`Processed ${i + batch.length}/${words.length} words for ${level}`);
      }

      // Add metadata
      updates[`${level}/metadata`] = {
        total_words: words.length,
        last_updated: new Date().toISOString(),
        source: 'Jisho API'
      };
    }

    // Update database
    await vocabularyRef.update(updates);
    console.log('Database build completed successfully!');
  } catch (error) {
    console.error('Error building database:', error);
    throw error;
  }
}

// Main execution
async function main() {
  try {
    await buildVocabularyDatabase();
    console.log('Database build completed!');
  } catch (error) {
    console.error('Failed to build database:', error);
    process.exit(1);
  }
}

main(); 